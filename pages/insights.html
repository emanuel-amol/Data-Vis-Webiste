<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Time Trends - Road Safety Enforcement</title>
  <link rel="stylesheet" href="../css/styles.css">
  <link rel="stylesheet" href="../css/storytelling.css">
  <link rel="stylesheet" href="../css/advanced-interactions.css">
  <link rel="stylesheet" href="../css/data-story-enhancements.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <header>
    <div class="full-header">
      <h1 class="heading">Australian Road Safety Enforcement</h1>
    </div>
    <nav class="nav-container">
      <div class="container">
        <div class="nav-buttons">
          <a href="../index.html" class="nav-btn">Home</a>
          <a href="time-trends.html" class="nav-btn">Time Trends</a>
          <a href="jurisdictions.html" class="nav-btn">Jurisdictions</a>
          <a href="age-analysis.html" class="nav-btn">Age Demographics</a>
          <a href="drugs_&_alcohol_analysis.html" class="nav-btn">Drugs and Alcohol</a>
          <a href="comparative-analysis.html" class="nav-btn">Comparative Analysis</a>
          <a href="insights.html" class="nav-btn active">Key Insights</a>
          <a href="data-story.html" class="nav-btn">Data Story</a>
          <a href="about.html" class="nav-btn">About</a>
        </div>
      </div>
    </nav>
  </header>


  <main>
    <!-- Hero Section -->
    <div class="hero-story">
      <div class="container">
        <div class="story-hook">
          <h2>Policy Maker Dashboard: Evidence-Based Road Safety Insights</h2>
          <p style="font-size: 1.2rem; opacity: 0.9; margin-top: 20px;">Interactive analysis tools for data-driven policy development and jurisdictional comparisons</p>
        </div>
      </div>
    </div>

    <div class="container">
      <!-- Executive Summary -->
      <div class="stats-dashboard">
        <h3>Executive Summary: Counter-Intuitive Key Finding</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">üéØ</div>
            <div class="stat-card-content">
              <span class="key-stat counter" data-target="45">45</span>
              <div class="stat-description">% of violations by middle-aged drivers (40-64)</div>
              <div class="stat-change">Challenges conventional wisdom</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <div class="stat-card-content">
              <span class="key-stat counter" data-target="604750">604,750</span>
              <div class="stat-description">Middle-aged driver fines</div>
              <div class="stat-change">vs 298,300 young drivers</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üîç</div>
            <div class="stat-card-content">
              <span class="key-stat">2.0x</span>
              <div class="stat-description">More than young drivers</div>
              <div class="stat-change">Experience ‚â† Compliance</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Policy Maker Dashboard -->
      <div class="policy-dashboard">
        <h2>Interactive Jurisdictional Analysis Dashboard</h2>
        
        <!-- Dashboard Controls -->
        <div class="dashboard-controls">
          <div class="control-panel">
            <h4>Analysis Controls</h4>
            <div class="control-group">
              <label for="metric-select">Metric:</label>
              <select id="metric-select">
                <option value="total-fines">Total Fines</option>
                <option value="per-capita">Per Capita Rate</option>
                <option value="growth-rate">Growth Rate</option>
                <option value="technology-impact">Technology Impact</option>
              </select>
            </div>
            <div class="control-group">
              <label for="year-select">Year:</label>
              <select id="year-select">
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2021">2021</option>
                <option value="2020">2020</option>
                <option value="2019">2019</option>
                <option value="all">All Years</option>
              </select>
            </div>
            <div class="control-group">
              <button id="export-report" class="export-btn">üìä Export Report</button>
            </div>
          </div>
        </div>

        <!-- Main Dashboard Layout -->
        <div class="dashboard-grid">
          <!-- Interactive Map Section -->
          <div class="map-section">
            <div class="section-header">
              <h3>Interactive Jurisdiction Map</h3>
              <p>Click on jurisdictions to compare enforcement effectiveness</p>
            </div>
            
            <div id="australia-map-container">
              <div id="visualization-error" style="display: none"></div>
              <div id="australia-map"></div>
              
              <!-- Chart Containers -->
              <div class="chart-container">
                <div class="chart-title">Enforcement Trends Over Time</div>
                <div id="trend-chart"></div>
              </div>
              
              <div class="chart-container">
                <div class="chart-title">Jurisdiction Comparison (2023)</div>
                <div id="jurisdiction-bar-chart"></div>
              </div>
              
              <div class="chart-container">
                <div class="chart-title">Age Distribution</div>
                <div id="age-pie-chart"></div>
              </div>
              
              <div class="chart-container">
                <div class="chart-title">Performance vs Growth</div>
                <div id="performance-scatter"></div>
              </div>
            </div>
          </div>

          <!-- Contextual Insights Panel -->
          <div class="insights-panel">
            <div class="panel-header">
              <h3>Contextual Insights & Policy Implications</h3>
              <p id="selected-jurisdiction">Select a jurisdiction to view detailed analysis</p>
            </div>
            
            <div id="jurisdiction-details" class="jurisdiction-details" style="display: none;">
              <div class="detail-section">
                <h4 id="jurisdiction-name">Jurisdiction Name</h4>
                <div class="key-metrics">
                  <div class="metric-item">
                    <span class="metric-label">Total Fines:</span>
                    <span id="metric-fines" class="metric-value">-</span>
                  </div>
                  <div class="metric-item">
                    <span class="metric-label">Growth Rate:</span>
                    <span id="metric-growth" class="metric-value">-</span>
                  </div>
                  <div class="metric-item">
                    <span class="metric-label">National Ranking:</span>
                    <span id="metric-rank" class="metric-value">-</span>
                  </div>
                </div>
              </div>
              
              <div class="detail-section">
                <h4>Technology Impact</h4>
                <div id="technology-impact">
                  <p id="tech-description">Technology deployment analysis will appear here</p>
                  <div style="background: #ecfdf5; padding: 12px 15px; border-radius: 8px; margin-top: 15px; border: 1px solid #d1fae5; display: flex; justify-content: space-between; align-items: center;">
                    <span>2021 Technology Boost:</span>
                    <span id="tech-boost">+37%</span>
                  </div>
                </div>
              </div>
              
              <div class="detail-section" style="background: #fef3c7; padding: 20px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <h4 style="color: #92400e;">Policy Implications</h4>
                <div id="policy-recommendations">
                  <ul id="policy-list" style="margin: 15px 0 0 0; padding-left: 20px;">
                    <li style="margin-bottom: 10px; color: #78350f; line-height: 1.5;">Select a jurisdiction to view specific policy recommendations</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Scripts in proper loading order -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    // Script loading with error handling
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = () => reject(new Error(`Failed to load ${src}`));
        document.head.appendChild(script);
      });
    }

    // Load scripts in sequence
    async function loadInsightsScripts() {
      try {
        const scripts = [
          '/js/insights/enhanced-d3-data-loader.js',
          '/js/insights/d3-responsive-charts.js', 
          '/js/insights/d3-responsive-map-visualization.js',
          '/js/insights/d3-responsive-dashboard-controller.js',
          '/js/insights/d3-integration.js',
          '/js/insights/insights-main.js'
        ];

        for (const src of scripts) {
          await loadScript(src);
          console.log(`Loaded ${src}`);
        }
      } catch (error) {
        console.error('Error loading scripts:', error);
        document.getElementById('visualization-error').style.display = 'block';
        document.getElementById('visualization-error').innerHTML = `
          <div class="error-message">
            Failed to load required scripts. Please refresh the page or check console for details.
          </div>
        `;
      }
    }

    // Start loading when D3 is ready
    if (typeof d3 !== 'undefined') {
      loadInsightsScripts();
    } else {
      document.querySelector('script[src*="d3.v7.min.js"]').addEventListener('load', loadInsightsScripts);
    }
  </script>

  <!-- Debug utilities remain unchanged -->
  <script>
    // Debug utilities
    window.debugDashboard = function() {
      console.log('=== Debug Information ===');
      console.log('D3 available:', typeof d3 !== 'undefined');
      console.log('File API available:', !!window.fs);
      console.log('D3 Integration:', !!window.d3Integration);
      console.log('Dashboard ready:', window.d3Integration ? window.d3Integration.isReady() : false);
    };
    
    // Global error handling
    window.addEventListener('error', function(event) {
      console.error('Global error:', event.error);
    });
    
    window.addEventListener('unhandledrejection', function(event) {
      console.error('Unhandled promise rejection:', event.reason);
    });
  </script>
</body>
</html>